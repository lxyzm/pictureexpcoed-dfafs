#  <center>服务器配置</center>
## 一 . APACHE 安全配置
### 1.隐藏 Apache Apache Apache Apache 的版本号及其它敏感信息
#### &emsp;&emsp;默认情况下，很多 Apache 安装时会显示版本号及操作系统版本，甚至会显示服务器上安装的是什么样的 Apache 模块。这些信息可以为黑客所用，并且黑客还可以从中得知你所配置的服务器上的很多设置都是默认状态.这里有两条语句，你需要添加到你的 httpd.conf 文件中
```
ServerSignature Off
ServerTokens Prod
```
#### &emsp;&emsp;第一个ServerSignature Off告诉apache不要在错误页面或其他生成的页面上，第二个ServerTokens Prod告诉Apache只在Server头中返回Apache， 并在每个页面请求中返回
```
Server： Apache
```
### 2.通过更改 php.ini 里的 expose_php = Off 关闭显示php的版本号
###
#### &emsp;&emsp;目录浏览默认地是被启用的。要禁用这个特性，应编辑 http.conf文件，而且对每一个“Directory”指令，应清除“Indexs”引用.在Indexes前.加 + 代表允许目录浏览,加 – 代表禁止目录浏览在Indexes前（虚拟主机vrhost也可能）
```
<Directory /data/www/digital.com >
Options -Indexes -FollowSymLinks
</Directory>
```
### 4.关闭对.htaccess .htaccess .htaccess .htaccess 文件的支持
## &emsp;&emsp;.htaccess文件( 或者" 分布式配置文件")提供了针对每个目录改变配置的方法，即在一个特定的目录中放置一个包含指令的文件，其中的指令作用于此目录及其所有子目录.概述来说，htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/ 阻止特定的用户或者目录
#### 如果需要重载，则保证这些文件不能够被下载，或者把文件名改成非.htaccess 文件
```
AccessFileName .httpdoverride
```
### 5.隐藏 PHP 的扩展名
```
<IfModule mod_mime.c>
AddType application/x-httpd-php .shtml
</IfModule>
```
### 6.确保 Apache Apache Apache 以其自身的用户账号和组运行访问网站是apache权限
```
User apache
Group apache
```
### apache环境下禁止某文件夹内运行PHP脚本
```
<Directory "C:/phpStudy/www/upload">
ErrorDocument 404 /404/404.html
ErrorDocument 403 /404/403.html
<FilesMatch "\.(?i:php|php3|php4|phtml)$">
Order allow,deny
Deny from all
</FilesMatch>
</Directory>
```
#### 限制目录运行脚本（与上面类似）
```
open_basedir 限制ＰＨＰ只能访问那些目录
设置成:open_basedir=c:/www/a/
```

## 二. php安全
#### &emsp;&emsp;这个项目设置了错误报告的等级。不论是开发还是部署环境，强烈建议将这个项目设置为 E_ALL。在代码里可以通过：error_reporting(E_ALL)来设置
```
error_reporting
```
#### &emsp;&emsp;这个项目决定是否将错误显示在屏幕上（包含在输出中）。应当在开发中设置为 On，这样可以在开发时就发现错误；应当在部署环境中设置为 Off，这样在所有用户（和潜在攻击者）面前错误将被隐藏。在代码里可以通过ini_set(“display_errors”,”Off”);来设置。
```
display_errorsM
```
#### &emsp;&emsp;这个项目决定是否将错误写入日志。虽然这会引起性能损失，但是对于并不经常出现的错误这是非常必要的。如果在硬盘上记录错误带来了巨大的 I/O 负荷，比起应用程序的效率来说，这或许应当引起更多的注意。应当在部署环境中设置为 On
```
log_errors
```
#### &emsp;&emsp;这个项目决定了日志文件存放的位置和名字。一定要确保 web服务器对指定文件拥有权限。设置 error_reporting 为 E_ALL 对于强制初始化变量有帮助，因为使用一个未定义的变量会产生提示（notice）。
```
error_log
```
#### &emsp;&emsp;禁用一些会引起安全隐患的函数
```
disable_functions = phpinfo, shell_exec
```
#### PHP tag
##### <?
        short_open_tag 決定是否可使用短標記
        或是編譯php時 --enable-short-tags
##### <?=
        等價 <? echo
        自PHP 5.4.0起，always work!
##### <% %>、<%=
        自PHP 7.0.0起，被移除
        須將asp_tags設成On
##### <script
        自PHP 7.0.0起，被移除
        <script language="php">system("id"); </script>